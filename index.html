<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ColorShop | Pro Edition</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

<style>
  :root { --p: #6a5cff; --bg: #f6f7fb; --card: #fff; --txt: #333; --brd: #eeeeee; }
  [data-theme="dark"] { --bg: #121212; --card: #1e1e1e; --txt: #f0f0f0; --brd: #333; }
  [dir="rtl"] { text-align: right; }
  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
  body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--txt); transition: 0.3s; padding-bottom: 80px; }
  
  header { background: var(--p); color: #fff; padding: 12px 15px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1000; }
  .lang-cycle { background: rgba(255,255,255,0.2); border: 1px solid #fff; color: #fff; padding: 5px 12px; border-radius: 20px; cursor: pointer; font-size: 12px; font-weight: bold; }

  .tools { background: var(--card); border-bottom: 1px solid var(--brd); padding: 10px 15px; }
  .cats { display: flex; gap: 8px; overflow-x: auto; scrollbar-width: none; padding: 5px 0; }
  .cat-btn { padding: 6px 15px; border-radius: 20px; border: 1px solid var(--brd); background: var(--card); color: var(--txt); font-size: 12px; white-space: nowrap; }
  .cat-btn.active { background: var(--p); color: #fff; }

  .products { display: flex; flex-direction: column; gap: 20px; padding: 15px; }
  .product { background: var(--card); border-radius: 20px; border: 1px solid var(--brd); overflow: hidden; position: relative; }
  .gallery { width: 100%; aspect-ratio: 1/1; background: #eee; cursor: zoom-in; }
  .gallery img { width: 100%; height: 100%; object-fit: cover; }
  
  .p-info { padding: 15px; }
  .stats-row { display: flex; gap: 15px; font-size: 12px; color: #888; margin-bottom: 5px; }

  .panel { position: fixed; right: -110%; top: 0; width: 100%; max-width: 400px; height: 100%; background: var(--card); z-index: 3000; padding: 20px; transition: 0.4s; overflow-y: auto; }
  .panel.open { right: 0; box-shadow: -5px 0 20px rgba(0,0,0,0.1); }

  .del-box { flex: 1; border: 1px solid var(--brd); padding: 12px; border-radius: 12px; text-align: center; cursor: pointer; transition: 0.3s; }
  .del-box.active { border-color: var(--p); background: rgba(106, 92, 255, 0.1); color: var(--p); font-weight: bold; }

  .btn-p { background: var(--p); color: #fff; padding: 12px; border-radius: 12px; border: none; font-weight: bold; cursor: pointer; width: 100%; }
  input, select, textarea { width: 100%; padding: 12px; margin-top: 10px; border: 1px solid var(--brd); border-radius: 10px; background: var(--bg); color: var(--txt); }

  #lightbox { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 5000; justify-content: center; align-items: center; flex-direction: column; }
  #lightbox img { max-width: 100%; max-height: 85vh; object-fit: contain; }
  .z-nav { position: absolute; top: 50%; transform: translateY(-50%); color: white; font-size: 40px; padding: 20px; background: rgba(0,0,0,0.2); }

  #debug-log { display: none; position: fixed; bottom: 0; left: 0; width: 100%; background: rgba(0,0,0,0.9); color: #00ff00; font-family: monospace; font-size: 10px; padding: 5px; z-index: 9999; max-height: 50px; pointer-events: none; }

  /* Success Screen */
  #success-screen { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--card); z-index: 6000; justify-content: center; align-items: center; text-align: center; padding: 30px; }
</style>
</head>
<body>

<div id="debug-log">System Booting...</div>

<header>
  <div id="admin-trigger" style="font-weight:bold;">ColorShop</div>
  <div style="display:flex; gap:8px; align-items:center;">
    <button onclick="cycleLang()" class="lang-cycle" id="btn-lang">EN</button>
    <button onclick="toggleTheme()" style="background:none; border:none; color:white; font-size:18px;">üåì</button>
    <button onclick="togglePanel('cart-panel')" style="background:#fff; color:var(--p); border:none; padding:6px 14px; border-radius:10px; font-weight:bold;">üõí <span id="cart-count">0</span></button>
  </div>
</header>

<div class="tools">
  <input type="text" id="search-bar" placeholder="Search..." oninput="draw()">
  <div class="cats" id="cat-list"></div>
</div>

<div class="products" id="grid"></div>

<div id="lightbox">
  <span onclick="closeZoom()" style="position:absolute;top:20px;right:20px;color:white;font-size:40px;">&times;</span>
  <div class="z-nav" style="left:0" onclick="swapZoom(-1)">‚ùÆ</div>
  <div class="z-nav" style="right:0" onclick="swapZoom(1)">‚ùØ</div>
  <img id="zoom-img">
</div>

<div class="panel" id="cart-panel">
  <h3 id="txt-cart">Your Cart</h3>
  <div id="cart-items" style="margin-bottom:15px;"></div>
  <h4 id="txt-delivery">Delivery: <span id="delivery-cost">0</span> DA</h4>
  <h4 id="txt-total">Total: <span id="total-price">0</span> DA</h4>
  
  <input id="c-name" placeholder="Full Name">
  <input id="c-phone" type="tel" placeholder="Phone Number">
  <select id="c-wilaya" onchange="updateCartUI()"></select>
  
  <div style="display:flex; gap:10px; margin-top:15px;">
    <div class="del-box active" id="m-home" onclick="setDel('Home')">üè† Home</div>
    <div class="del-box" id="m-desk" onclick="setDel('Desk')">üì¶ Desk</div>
  </div>

  <button class="btn-p" onclick="checkout()" style="margin-top:20px;" id="txt-order">Order Now</button>
  <button onclick="togglePanel('cart-panel')" class="btn-p" style="background:#eee; color:#333; margin-top:10px;">Close</button>
</div>

<div id="success-screen">
    <div>
        <h1 style="font-size: 60px;">üéâ</h1>
        <h2 id="txt-success-title">Order Sent!</h2>
        <p id="txt-success-msg">Check your email app to complete the order. We will contact you soon.</p>
        <button class="btn-p" onclick="closeSuccess()">OK</button>
    </div>
</div>

<div class="panel" id="admin-panel" style="left:50%; top:50%; transform:translate(-50%,-50%); height:auto; display:none; right:auto;">
  <h3>Admin Dashboard</h3>
  <input id="n-name" placeholder="Product Name">
  <input id="n-price" type="number" placeholder="Price">
  <input id="n-cat" placeholder="Category">
  <textarea id="n-desc" placeholder="Description"></textarea>
  <input id="n-files" type="file" multiple>
  <button id="up-btn" onclick="addItem()" class="btn-p">Upload</button>
  <button onclick="logout()" class="btn-p" style="background:#eee; color:#333; margin-top:10px;">Logout</button>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyC8wtssEyyIgD5x3JLV_miPsoMrgvD9EDM",
  databaseURL: "https://colorshop-933e7-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "colorshop-933e7"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const deliveryRates = {
    "16 Algiers": { home: 400, desk: 300 },
    "31 Oran": { home: 700, desk: 400 },
    "25 Constantine": { home: 700, desk: 400 },
    "06 B√©ja√Øa": { home: 600, desk: 400 },
    "15 Tizi Ouzou": { home: 600, desk: 400 },
    "19 S√©tif": { home: 600, desk: 400 },
    "35 Boumerd√®s": { home: 500, desk: 350 },
    "default": { home: 800, desk: 500 }
};

const dict = {
  en: { cart: "Your Order", order: "Confirm Order", search: "Search...", dir: "ltr", lang: "EN", success: "Order Sent!", msg: "Please finish sending the email. We will call you soon." },
  fr: { cart: "Votre Panier", order: "Commander", search: "Chercher...", dir: "ltr", lang: "FR", success: "Commande Envoy√©e !", msg: "Veuillez envoyer l'email pour confirmer. √Ä bient√¥t !" },
  ar: { cart: "ÿ∑ŸÑÿ®Ÿäÿßÿ™ŸÉ", order: "ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑÿ∑ŸÑÿ®", search: "ÿ®ÿ≠ÿ´...", dir: "rtl", lang: "AR", success: "ÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ∑ŸÑÿ®!", msg: "Ÿäÿ±ÿ¨Ÿâ ÿ•ŸÉŸÖÿßŸÑ ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ•ŸäŸÖŸäŸÑ ŸÑÿ™ÿ£ŸÉŸäÿØ ÿßŸÑÿ∑ŸÑÿ®. ÿ≥ŸÜÿ™ÿµŸÑ ÿ®ŸÉ ŸÇÿ±Ÿäÿ®ÿßŸã." }
};

let items = [], cart = [], isAdmin = false, curLang = 'en', curCat = 'All', delMode = 'Home';
let curZoomKey = null, zoomIdx = 0;

const deviceID = localStorage.getItem('device_id') || ('dev_' + Math.random().toString(36).substr(2, 9));
localStorage.setItem('device_id', deviceID);

function log(m) { const d = document.getElementById('debug-log'); d.innerHTML = `> ${m}<br>${d.innerHTML}`; }

function cycleLang() {
    const sequence = ['en', 'fr', 'ar'];
    curLang = sequence[(sequence.indexOf(curLang) + 1) % sequence.length];
    setLang(curLang);
}

function setLang(l) {
    document.body.dir = dict[l].dir;
    document.getElementById('btn-lang').innerText = dict[l].lang;
    document.getElementById('search-bar').placeholder = dict[l].search;
    document.getElementById('txt-cart').innerText = dict[l].cart;
    document.getElementById('txt-order').innerText = dict[l].order;
    document.getElementById('txt-success-title').innerText = dict[l].success;
    document.getElementById('txt-success-msg').innerText = dict[l].msg;
    draw();
}

db.ref('products').on('value', snap => {
    const data = snap.val();
    items = data ? Object.keys(data).map(k => ({...data[k], fbKey: k})) : [];
    draw();
});

function draw() {
    const g = document.getElementById("grid");
    const s = document.getElementById("search-bar").value.toLowerCase();
    g.innerHTML = "";
    const filtered = items.filter(i => (curCat === 'All' || i.cat === curCat) && i.name.toLowerCase().includes(s));
    
    filtered.forEach(p => {
        g.innerHTML += `
        <div class="product">
            ${isAdmin ? `<button onclick="deleteItem('${p.fbKey}')" style="position:absolute;top:10px;right:10px;z-index:5;background:red;color:white;border:none;border-radius:50%;width:25px;height:25px;">&times;</button>` : ''}
            <div class="gallery" onclick="openZoom('${p.fbKey}')"><img src="${p.imgs[0]}"></div>
            <div class="p-info">
                <div class="stats-row"><span>üëÅÔ∏è ${p.unique_views ? Object.keys(p.unique_views).length : 0}</span> <span>‚ù§Ô∏è ${p.likes || 0}</span></div>
                <p class="p-price">${p.price} DA</p>
                <h3 class="p-title" style="margin:5px 0">${p.name}</h3>
                <p class="p-desc">${p.desc || ''}</p>
                <button class="btn-p" onclick="addToCart('${p.fbKey}')">Add to Cart</button>
            </div>
        </div>`;
    });
    updateCats();
}

function openZoom(key) {
    const p = items.find(i => i.fbKey === key);
    curZoomKey = key; zoomIdx = 0;
    db.ref(`products/${key}/unique_views/${deviceID}`).set(true);
    document.getElementById('zoom-img').src = p.imgs[0];
    document.getElementById('lightbox').style.display = 'flex';
}

function swapZoom(dir) {
    const p = items.find(i => i.fbKey === curZoomKey);
    zoomIdx = (zoomIdx + dir + p.imgs.length) % p.imgs.length;
    document.getElementById('zoom-img').src = p.imgs[zoomIdx];
}

function setDel(mode) {
    delMode = mode;
    document.getElementById('m-home').classList.toggle('active', mode==='Home');
    document.getElementById('m-desk').classList.toggle('active', mode==='Desk');
    updateCartUI();
}

function addToCart(key) {
    const p = items.find(i => i.fbKey === key);
    cart.push(p);
    document.getElementById('cart-count').innerText = cart.length;
    updateCartUI();
}

function updateCartUI() {
    const list = document.getElementById('cart-items');
    let subtotal = 0;
    list.innerHTML = cart.map(i => {
        subtotal += i.price;
        return `<div style="display:flex; justify-content:space-between; margin:8px 0;"><span>${i.name}</span><b>${i.price} DA</b></div>`;
    }).join('');

    const w = document.getElementById('c-wilaya').value;
    const rates = deliveryRates[w] || deliveryRates["default"];
    const ship = (delMode === 'Home') ? rates.home : rates.desk;
    
    document.getElementById('delivery-cost').innerText = ship;
    document.getElementById('total-price').innerText = subtotal + ship;
}

function checkout() {
    const n = document.getElementById('c-name').value, ph = document.getElementById('c-phone').value, w = document.getElementById('c-wilaya').value;
    if(!n || !ph || cart.length === 0) return alert("Fill Name & Phone!");

    const rates = deliveryRates[w] || deliveryRates["default"];
    const ship = (delMode === 'Home') ? rates.home : rates.desk;
    const total = cart.reduce((s, i) => s + i.price, 0) + ship;

    let body = `--- NEW ORDER ---\nCustomer: ${n}\nPhone: ${ph}\nLocation: ${w} (${delMode})\n\nItems:\n` + cart.map(i => `- ${i.name}`).join('\n') + `\n\nDelivery: ${ship} DA\nTOTAL: ${total} DA`;
    
    window.location.href = `mailto:fullshopdz@gmail.com?subject=Order_${n}&body=${encodeURIComponent(body)}`;
    
    // Show Success Screen
    setTimeout(() => {
        document.getElementById('success-screen').style.display = 'flex';
    }, 1000);
}

function closeSuccess() {
    cart = [];
    document.getElementById('cart-count').innerText = "0";
    document.getElementById('cart-panel').classList.remove('open');
    document.getElementById('success-screen').style.display = 'none';
    updateCartUI();
}

// Admin Trigger
let taps = 0;
document.getElementById('admin-trigger').onclick = () => {
    taps++; if(taps === 4) { if(prompt("Pass:") === "12346") { 
        isAdmin = true; 
        document.getElementById('admin-panel').style.display='block';
        document.getElementById('debug-log').style.display='block';
    } taps=0; }
};

async function addItem() {
    const n = document.getElementById('n-name').value, p = document.getElementById('n-price').value, c = document.getElementById('n-cat').value, d = document.getElementById('n-desc').value, f = document.getElementById('n-files').files;
    const btn = document.getElementById('up-btn'); btn.disabled = true;
    let imgs = [];
    for(let file of f) {
        const b64 = await new Promise(r => { const rd = new FileReader(); rd.readAsDataURL(file); rd.onload = e => r(e.target.result); });
        imgs.push(b64);
    }
    await db.ref('products').push({ name: n, price: parseInt(p), cat: c, desc: d, imgs: imgs, likes: 0, views: 0 });
    alert("Uploaded!"); location.reload();
}

function updateCats() {
    const categories = ["All", ...new Set(items.map(i => i.cat))];
    document.getElementById('cat-list').innerHTML = categories.map(c => `<button class="cat-btn ${curCat===c?'active':''}" onclick="curCat='${c}'; draw()">${c}</button>`).join('');
}

function togglePanel(id) { document.getElementById(id).classList.toggle('open'); }
function closeZoom() { document.getElementById('lightbox').style.display='none'; }
function logout() { isAdmin = false; location.reload(); }
function toggleTheme() { document.body.setAttribute('data-theme', document.body.getAttribute('data-theme')==='dark'?'light':'dark'); }

const wList = ["16 Algiers", "31 Oran", "25 Constantine", "06 B√©ja√Øa", "15 Tizi Ouzou", "19 S√©tif", "35 Boumerd√®s"];
wList.forEach(w => { let o = document.createElement('option'); o.value=w; o.text=w; document.getElementById('c-wilaya').add(o); });
</script>
</body>
</html>
